---
title: 立即执行函数和闭包再总结
---
&emsp;&emsp;我们常常听到别人问:什么是立即执行函数？什么是闭包？它们有什么联系？它们的作用是什么？最近刚好对这个问题有些思考，这里就做一下下总结

## 立即执行函数

&emsp;&emsp;要说什么是立即函数，顾名思义，立即执行的函数呗，那么为什么要用立即执行函数呢？这就要从一个老生常谈的问题说起了

### 变量污染

&emsp;&emsp;我们知道，所有在函数外定义的变量都是全局变量，而全局变量多了，难免不出现一不小心被覆盖的问题，尤其是在多人合作开发的项目中，可以想象每个人在写自己的模块的代码时都定义一堆全局变量，一旦出现被覆盖的问题，极有可能引发大的bug
&emsp;&emsp;那么，怎么解决全局变量带来的变量污染的问题呢？简单啦，不用全局变量就可以啦 

### 局部变量替代全局变量

&emsp;&emsp;为了杜绝变量污染，我们选择抛弃全局变量，而只用局部变量，而ES5中，只有函数中用var 声明的变量才是局部变量，(ES6中{},新增了块级作用域，代码块中用let定义的变量也是局部变量，但这里为了通用，不考虑ES6),所以我们必须将所有变量的初始化和赋值都在函数作用域内进行。

#### 函数的引入

&emsp;&emsp;我们在函数中进行变量相关的所有操作，但是函数仅仅声明的话是没有用的，必须要调用，它的代码才会被执行，它自身的定义才有意义，像下面这样：

```
function abc(){
    var a=1;
    var b=2;
    ....
}
abc()；
```

&emsp;&emsp;可以看到，这种方式不可避免的是至少有一个变量依然会是全局变量，即函数名称，因为函数终究会被调用，所以我们要给它起一个名字，否则不知道名字怎么调用它呢？等等等，不知道名字也能调用啊，匿名函数就是啦

#### 立即调用的匿名函数

&emsp;&emsp;匿名函数时可以调用的，这个我们都知道的，只不过一开始对匿名函数的调用方式总是混淆，比如说以下几种方式，哪几种是对的，哪几种是错的？ 

```
1. function(){
    ....
}()

2. (function(){

})()

3. (function(){

}())
4. !function(){

}()
5. ~function(){

}()

```

&emsp;&emsp;稍微有一点点经验的可能会肯定的说1，4,5是错的，2,4是对的(因为书上这么教我滴)，但不好意思，答错啦，可能是那本书只教了一半吧，事实上，除了1以外，其它几种方法都是正确的。

&emsp;&emsp;为什么是这样呢？应该是和浏览器的解析机制有关吧，它认为，如果是单独的`function(){}()`这样的形式，不能确定你是想调用函数，会报语法的错误，但是当你加了`()`,`~`,`!`等符号会，它会认为这是一个表达式，会把后`()`看到是在调用，会顺利的帮你执行这个函数(可以试试`+`,`-`等符号，有惊喜)

&emsp;&emsp;到这里发现了，立即调用的匿名函数就是立即执行函数啦(匿名函数还可以作为参数传入后被调用，这个就与我们说的立即执行函数无关啦)

## 闭包

&emsp;&emsp;纯粹的立即执行函数大多数情况下回面临一个问题，就是我想让这个函数里的信息和其它模块之间能够交互，该怎么办呢(在模块开发中，这很常见的，几乎不可能让各模块之间毫无交流)？解决这个问题又两个办法：

> 1.在函数中将需要提供给外界的接口作为属性值赋值给window对象，像下面这样： 

```
!function(){
    ...
    window.a={
      b:2,
    }
}()

```

> 2. 将立即执行函数赋值给一个变量,并且函数内返回特定值(相当于将这个返回值赋给了一个变量)

```

var a=!function(){
    ...
    return{
        b:2,
    }
}()
```

&emsp;&emsp;可以看到1和2两种方式都能够将立即执行函数的内部信息传递给外界，而且乍一看上去，好像方式1更好一点，貌似少用了一个变量啊，其实不然，它最终还是经过了为window对象添加属性的，等同于增加了全局变量，并且还有一个缺点，试想，如果这个函数代码超长，我还需要在函数内去
搜索到底哪些地方对window赋值了，才能知道这个立即函数执行后添加了哪些全局变量，所以显然方式2就逻辑清晰多了，只要我们约定俗称了，只需看整个函数所赋值的变量，一切就都明了啦，当然，用方式2的方法，最终要的一点可能是：显得高大上，哈哈

&emsp;&emsp;说到这里，还没说到闭包呢，闭包就是能够访问到外部函数内的变量的函数(函数+能访问到外部函数中的变量，缺一不可~),闭包的常用场景之一是：利用闭包和立即执行函数结合，使得内部信息得以隐藏，只返回必要的方法作为外部接口，实现模块化，现在结合上述提到的立即执行函数的一系列心路历程，感觉清晰了好多！

